
CREATE TYPE tag_type AS ENUM (
    'author',
    'contest',
    'level',
    'method',
    'other'
); 


CREATE TABLE IF NOT EXISTS tags (
    id      bigint      GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name    text        NOT NULL UNIQUE,
    type    tag_type    NOT NULL
);

CREATE TABLE IF NOT EXISTS problem_tags (
    tag_id      bigint  NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    problem_id  bigint  NOT NULL REFERENCES problems(id) ON DELETE CASCADE,
    position    bigint  NOT NULL DEFAULT 0,
    UNIQUE (tag_id, problem_id)
);

CREATE INDEX IF NOT EXISTS problem_tag_problems ON problem_tags (problem_id);