<!DOCTYPE html>
<html lang="{{language}}" {{if isDarkMode}}class="dark"{{end}}>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>{{block "title" .}}Kilonova{{end}}</title>
	{{- $fav := hashedName "static/favicon.ico"}}
	{{$bundle := hashedName "static/bundle.js"}}
	{{$vendored := hashedName "static/vendored.js"}}
	{{$style := hashedName "static/styles.css" -}}

	<link rel="icon" type="image/x-icon" href="/{{$fav}}"/>
	<link rel="shortcut icon" type="image/x-icon" href="/{{$fav}}"/>
	
	<!-- OpenGraph stuff -->
	<meta property="og:title" content="{{template `title` .}}" />
	<meta property="og:type" content="website" />
	<meta property="og:description" content="{{block `description` .}}Programming platform for learning and practising{{end}}" />
	<meta name="description" content="{{template `description` .}}" />
	<meta property="og:locale" content="ro_RO" />
	<meta property="og:site_name" content="Kilonova" />

	<!--Dependency bundle-->
	<script src="/{{$bundle}}"></script>
	<script src="/{{$vendored}}"></script>

	<script>
		hljs.configure({languages:['c', 'cpp', 'py', 'go', 'haskell', 'python3']}) // TODO
		hljs.highlightAll();

		var platform_info = {
			debug: {{debug}},
			admin: {{if .Ctx.User}}{{.Ctx.User.Admin}}{{else}}false{{end}},
			user_id: {{if .Ctx.User}}{{.Ctx.User.ID}}{{else}}0{{end}},
			language: {{language}},
            langs: {{pLanguages}},
		};
	</script>

	<script>
CodeMirror.defineInitHook(bundled.CodeMirrorThemeHook)
CodeMirror.defaults.lineNumbers = true;
CodeMirror.defaults.indentUnit = 4;
CodeMirror.defaults.tabSize = 4;
CodeMirror.defaults.indentWithTabs = true;
CodeMirror.defaults.lineWrapping = true;
CodeMirror.defaults.viewportMargin = Infinity;
if(bundled.isDarkMode()) {  // Dark Mode
	CodeMirror.defaults.theme = "monokai";
}
	</script>

	{{ block "head" . }} {{ end }}

	<link rel="stylesheet" href="/{{$style}}" />
</head>

<body>
	{{ template "navbar" . }}

	{{- if .Ctx.User }}
		{{ if not .Ctx.User.VerifiedEmail }}
			<div class="w-full py-1 px-2 bg-green-200 dark:bg-green-700 text-black dark:text-white text-center">{{ getText "unverifiedEmail" }}</div>
		{{ end }}
	{{ end -}}
	
	<div class="c-container mb-2">
		{{ block "content" . }}
			<h1> Well... this is awkward... There's no content </h1>
		{{ end }}
	</div>


<!-- TODO: Maybe move this somewhere more appropriate? -->
<dialog class="modal-container" id="max_score_dialog">
    <div class="modal-header">
        <h1>{{getText "score_breakdown_title"}}</h1>
        <form method="dialog">
            <button type="submit"><i class="modal-close"></i></button>
        </form>
    </div>
    <div class="modal-content" id="max_score_content">
        <!-- <kn-score-breakdown problemid="1" /> -->
    </div>
</dialog>
<script>
    const dialogRoot = document.getElementById("max_score_dialog")
    const dialogContent = document.getElementById("max_score_content")
    
    function buildModal(problemID, contestID) {
        const val = document.getElementById("max_score_preact")
        if(val != null) {
            dialogContent.removeChild(val)
        }
        const newVal = document.createElement("kn-score-breakdown")
        newVal.id = "max_score_preact"
        newVal.setAttribute("problemid", problemID)
        if(typeof contestID !== "undefined") {
            newVal.setAttribute("contestid", contestID)
        }

        dialogContent.appendChild(newVal)
    }
    
    Array.from(document.getElementsByClassName("max_score_breakdown")).forEach(val => {
        val.addEventListener("click", e => {
            e.preventDefault();
            dialogRoot.close()

            let problemID = parseInt(e.currentTarget.dataset.problemid);
            if(isNaN(problemID)) {
                bundled.apiToast({status: "error", data: "Invalid problem id for max score modal"})
                return
            }
            let contestID = parseInt(e.currentTarget.dataset.contestid);
            if(isNaN(contestID)) {
                contestID = undefined;
            }
            buildModal(problemID, contestID)

            dialogRoot.showModal()
        })
    })
</script>

	{{ template "footer" . }}
</body>

</html>
