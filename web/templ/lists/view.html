{{ define "title" }} #{{.ProblemList.ID}}: {{.ProblemList.Title}} {{ end }}
{{ define "content" }}

{{ $user := .Ctx.User.Brief }}
{{ $root := . }}
{{ $ctx := .Ctx }}
{{ with .ProblemList }}
    {{ $pbs := (listProblems $user .) }}
    <div class="list-group list-group-mini mb-4">
        <details class="list-group-head" open>
            <summary class="pb-1 mt-1">
                <span class="float-left"><a href="/problem_lists/{{.ID}}">#{{.ID}}</a> {{.Title}}</span>
                {{if $user}}
                    <span class="float-right rounded-full py-1 px-2 text-base bg-teal-700 text-white font-semibold">
                        {{ getText $ctx.Language "num_solved_v2" (numSolved $user .List) (len $pbs) }}
                    </span>
                {{end}}
            </summary>
            {{ if .Description }}<div class="list-group m-1 my-1"><div class="list-group-head">{{renderMarkdown .Description}}</div></div>{{end}}
            {{ with $pbs }}
                {{ template "pb_list_group" (genPbListParams $user $root.Ctx.Language .) }}
            {{ else }}
                <p> {{ getText $ctx.Language "problem.none_in_list" }} </p>
            {{ end }}
        </details>
    </div>
	{{ if $user }}
	{{ if or (eq $user.ID .AuthorID) $user.Admin }}
	<form id="pblist-update" class="segment-container" autocomplete="off">
		<h1> {{getText $root.Ctx.Language "list.update"}} </h1>
		<div class="block my-2">
			<label>
				<span class="form-label">{{getText $root.Ctx.Language "title"}}: </span>
				<input type="text" id="pblist-title" class="form-input" value="{{.Title}}">
			</label>
		</div>
		<div class="block my-2">
			<label>
				<span class="form-label">{{getText $root.Ctx.Language "pbs"}}:</span>
				<input type="text" id="pblist-list" class="form-input" pattern="([0-9]+,?)+" value="{{intList .List}}">
			</label>
		</div>
		<div class="block mt-2 mb-4">
			<label>
				<span class="form-label">{{getText $root.Ctx.Language "desc"}}: </span>
				<textarea id="desc_tarea" class="hidden">{{- .Description -}}</textarea>
				{{/* <input type="text" id="pblist-desc" class="form-input" value="{{.Description}}"> */}}
			</label>
		</div>
		<button class="btn btn-blue mr-2" type="submit">{{getText $root.Ctx.Language "button.update"}}</button>
        <button id="delButton" class="btn btn-red">{{getText $root.Ctx.Language "button.delete"}}</button>
	</form>
<script>
let problemListID = {{.ID}};
var cm = CodeMirror.fromTextArea(document.getElementById("desc_tarea"), {
	mode: {
		name: "gfm",
		gitHubSpice: false,
		emoji: false,
	}
});
cm.setSize(null, "100%");

async function updateProblemList(e) {
	e.preventDefault();
	let data = {
		id: problemListID,
		title: document.getElementById("pblist-title").value,
		description: cm.getValue(),
		list: bundled.stringIntToNumber(document.getElementById("pblist-list").value.split(',')),
	};
	let res = await bundled.bodyCall("/problemList/update", data)
	if(res.status === "success") {
		window.location.reload();
		return
	}
	bundled.apiToast(res)
}
async function deleteProblemList(e) {
    e.preventDefault();
    let data = {
        id: problemListID
    }
    let res = await bundled.postCall("/problemList/delete", data)
    if(res.status === "success") {
        window.location.assign("/problem_lists");
        return
    }
    bundled.apiToast(res);
}
document.getElementById("pblist-update").addEventListener("submit", updateProblemList)
document.getElementById("delButton").addEventListener("click", deleteProblemList);
</script>
	{{ end }}
	{{ end }}
{{ end }}


{{ end }}
